<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title></title>

    <script type="text/javascript">

    console.log("should be 983bb35ed0a800fcc85d12806df9225364713be578ba67f65bc508b77f0c54878eda18a5eed50bac705bdc7db205623221e8ffe330483955a22216960754a122");

    var CalcTest = function(block){
      console.log(block)
      let r = new Uint8Array(64);


      for (let i = 0; i < block.length; i++) {
        r[i] = block.charCodeAt(i);
      }

      for (let i = 32; i < 64; i++) {
        r[i] = i * 48271;
      }

      Math.sgn = function(a) { return 1/a < 0 ; };

      let xor = function (imm) {
        for (let i = 0; i < 64; i++) {
          r[i] ^= imm[i];
        }
      };

      let perm = function (imm) {
        let n = new Uint8Array(64);
        for (let i = 0; i < 512; i++) {
          const dst_bit = i%8;
          const dst_byte = i/8|0;
          const sign = Math.sgn(imm[i]);
          const idx = sign ? -imm[i] : imm[i];
          const src_bit = idx%8;
          const src_byte = idx/8|0;

          if (i < 3) {
            // console.log(r);
            console.log(i + " :src byte/bit: " +  src_byte + "/" + src_bit + " | dst byte/bit: " + dst_byte + "/" + dst_bit + " | idx: " + idx + " | imm: " + imm[i]);
          }

          let b = (r[src_byte] >> src_bit) & 1;
          if (sign) { b ^= 1; } //ok
          n[dst_byte] |= b << dst_bit;
        }
        r = n;
      };


      let deperm = function (imm) {
        let n = new Uint8Array(64);

        for (let i = 511; i >= 0; i--) {
          const dst_bit = i%8;
          const dst_byte = i/8|0;
          const sign = Math.sgn(imm[i]);
          const idx = sign ? -imm[i] : imm[i];
          const src_bit = idx%8;
          const src_byte = idx/8|0;


          if (i < 3) {
            // console.log(r);
            console.log(i + " :src byte/bit: " +  src_byte + "/" + src_bit + " | dst byte/bit: " + dst_byte + "/" + dst_bit + " | idx: " + idx + " | imm: " + imm[i]);
          }

          let b = (r[dst_byte] >> dst_bit) & 1;
          if (sign) { b ^= 1; }
          n[src_byte] |= b << src_bit;
        }
        r = n;
      };

      console.log("before Perm");
      console.log(r);


      perm([408,-511,-243,-164,493,12,-309,-172,358,158,-344,-46,326,-322,497,-8,91,-395,235,-36,-448,223,-403,57,-42,-388,-269,447,-435,186,100,425,-26,432,-360,370,-191,181,142,-401,15,211,-421,-109,342,-504,-288,-444,-264,-397,-384,298,-98,240,-292,-49,-256,362,-490,428,-193,347,510,-204,-449,-263,-253,33,-4,509,381,-66,220,113,67,-93,-126,-219,-495,406,-429,232,-224,90,64,-32,373,-23,92,-459,114,329,319,-0,-279,-404,442,-505,-361,104,-30,-423,-350,-251,-467,-133,-254,434,29,-476,498,-75,-234,185,152,97,-160,163,337,268,82,212,201,-426,-311,217,267,318,-69,-349,-378,287,-41,-131,227,157,332,-500,-297,-456,-139,377,462,-491,-2,455,247,-405,321,-24,-159,-118,-454,-180,280,416,108,-156,-124,452,-411,359,-457,71,-183,218,-242,-61,-258,492,317,-55,-9,-272,198,-226,478,302,146,-182,327,-47,99,-305,346,324,87,357,22,21,437,-231,-364,166,-130,289,-453,190,17,367,282,68,-141,-310,-281,303,215,120,-78,323,153,-368,-328,-72,-7,-334,410,-481,44,62,-458,246,150,244,482,86,-488,103,202,424,-402,197,276,-471,-177,252,293,-65,-200,-37,70,-122,-306,-431,-387,-39,-213,-203,299,-145,-119,-96,-73,94,339,-105,-60,-132,53,-308,18,393,-225,-241,-162,-278,430,-294,506,84,-259,-168,-161,-479,-85,-248,101,-116,-249,-261,-175,400,503,-314,501,54,-56,-409,-6,-79,34,14,-438,464,236,216,-208,-206,-507,351,-390,107,333,-194,353,-127,77,-52,371,3,-300,385,304,420,277,469,394,-28,352,399,-295,386,-250,366,475,463,102,-468,-439,417,-128,-214,-135,446,-125,-496,407,-184,341,-487,-136,-375,-167,-380,-284,16,-176,-398,48,-283,189,-147,58,-5,76,-266,382,-474,415,245,-313,199,470,-209,38,20,315,418,-379,-81,-148,392,494,330,296,461,239,1,123,-222,-165,499,-325,-27,-291,40,433,-51,196,-343,502,483,262,-233,31,-169,414,-134,-121,-111,-508,-436,-238,-485,-369,230,473,174,89,270,138,95,-374,-151,-35,-465,-274,338,210,-331,-365,-59,188,-320,-149,110,413,-355,451,-290,-316,-187,74,178,-229,13,-106,-117,-140,-144,-312,-286,173,-80,-480,-63,-43,427,412,-348,396,440,154,-472,-307,50,-356,257,25,112,-336,-170,207,-460,-419,-340,10,-115,-192,-273,-376,441,83,195,285,-11,-171,-260,19,335,-372,237,391,143,450,205,-477,-45,-255,-275,484,443,-363,228,137,179,-422,265,466,-389,155,486,88,-383,354,445,221,489,271,-301,-345,129]);

      console.log("--------------------------");

       deperm([408,-511,-243,-164,493,12,-309,-172,358,158,-344,-46,326,-322,497,-8,91,-395,235,-36,-448,223,-403,57,-42,-388,-269,447,-435,186,100,425,-26,432,-360,370,-191,181,142,-401,15,211,-421,-109,342,-504,-288,-444,-264,-397,-384,298,-98,240,-292,-49,-256,362,-490,428,-193,347,510,-204,-449,-263,-253,33,-4,509,381,-66,220,113,67,-93,-126,-219,-495,406,-429,232,-224,90,64,-32,373,-23,92,-459,114,329,319,-0,-279,-404,442,-505,-361,104,-30,-423,-350,-251,-467,-133,-254,434,29,-476,498,-75,-234,185,152,97,-160,163,337,268,82,212,201,-426,-311,217,267,318,-69,-349,-378,287,-41,-131,227,157,332,-500,-297,-456,-139,377,462,-491,-2,455,247,-405,321,-24,-159,-118,-454,-180,280,416,108,-156,-124,452,-411,359,-457,71,-183,218,-242,-61,-258,492,317,-55,-9,-272,198,-226,478,302,146,-182,327,-47,99,-305,346,324,87,357,22,21,437,-231,-364,166,-130,289,-453,190,17,367,282,68,-141,-310,-281,303,215,120,-78,323,153,-368,-328,-72,-7,-334,410,-481,44,62,-458,246,150,244,482,86,-488,103,202,424,-402,197,276,-471,-177,252,293,-65,-200,-37,70,-122,-306,-431,-387,-39,-213,-203,299,-145,-119,-96,-73,94,339,-105,-60,-132,53,-308,18,393,-225,-241,-162,-278,430,-294,506,84,-259,-168,-161,-479,-85,-248,101,-116,-249,-261,-175,400,503,-314,501,54,-56,-409,-6,-79,34,14,-438,464,236,216,-208,-206,-507,351,-390,107,333,-194,353,-127,77,-52,371,3,-300,385,304,420,277,469,394,-28,352,399,-295,386,-250,366,475,463,102,-468,-439,417,-128,-214,-135,446,-125,-496,407,-184,341,-487,-136,-375,-167,-380,-284,16,-176,-398,48,-283,189,-147,58,-5,76,-266,382,-474,415,245,-313,199,470,-209,38,20,315,418,-379,-81,-148,392,494,330,296,461,239,1,123,-222,-165,499,-325,-27,-291,40,433,-51,196,-343,502,483,262,-233,31,-169,414,-134,-121,-111,-508,-436,-238,-485,-369,230,473,174,89,270,138,95,-374,-151,-35,-465,-274,338,210,-331,-365,-59,188,-320,-149,110,413,-355,451,-290,-316,-187,74,178,-229,13,-106,-117,-140,-144,-312,-286,173,-80,-480,-63,-43,427,412,-348,396,440,154,-472,-307,50,-356,257,25,112,-336,-170,207,-460,-419,-340,10,-115,-192,-273,-376,441,83,195,285,-11,-171,-260,19,335,-372,237,391,143,450,205,-477,-45,-255,-275,484,443,-363,228,137,179,-422,265,466,-389,155,486,88,-383,354,445,221,489,271,-301,-345,129]);

      console.log("after Perm");
      console.log(r);

    }




    CalcTest("123456789012345678901234567");


    </script>
  </head>
  <body>

  </body>
</html>
